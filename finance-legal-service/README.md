# Finance-Legal Service

Финансово-правовой модуль для проекта Nodeorb. Предоставляет комплексную систему финансового учета и юридического сопровождения с поддержкой международных стандартов МСФО/US GAAP.

## Основная функциональность

### Бухгалтерский учет
- Двойная запись (дебет/кредит) с автоматической проверкой баланса
- План счетов с поддержкой МСФО, US GAAP и национальных стандартов
- Учет активов, обязательств, капитала, доходов и расходов
- Автоматическая амортизация основных средств
- Учет запасов по методам FIFO, LIFO, средневзвешенной стоимости
- Мультивалютность и автоматическая конвертация валют

### Финансовая отчетность
- Автоматическая генерация баланса (IAS 1 / ASC 210)
- Отчет о прибылях и убытках (P&L Statement)
- Отчет о движении денежных средств (Cash Flow Statement)
- Отчет об изменениях капитала
- Консолидация отчетности для группы компаний
- Экспорт в PDF, Excel, XBRL, XML

### Налоговый учет
- Автоматический расчет налогов: НДС, налог на прибыль, подоходный налог
- Поддержка налоговых систем: ЕС (VAT), США (IRS), Россия (ФНС)
- Генерация налоговых деклараций и форм
- Учет отложенных налоговых активов и обязательств (IAS 12)
- Трансфертное ценообразование для международных операций

### Юридический модуль
- Управление договорами с электронной подписью
- Шаблоны договоров с возможностью кастомизации
- Претензионная работа и управление спорными ситуациями
- Корпоративная документация и лицензии
- Контроль сроков действия и автопродление

### Страхование
- Оформление полисов страхования грузов онлайн
- Страхование гражданской и профессиональной ответственности
- Расчет страховой премии на основе стоимости, типа груза, маршрута
- Учет страховых случаев и выплат
- Поддержка международных страховых стандартов

### Таможенные службы
- Автоматическая генерация таможенных документов: CMR, коносаменты, инвойсы
- Электронное декларирование (ЕАЭС, EU, US Customs)
- Расчет таможенных пошлин по ТН ВЭД
- Интеграция с таможенными брокерами через API
- Отслеживание статуса таможенного оформления

### Система управления платежами
- Интеграция с платежными шлюзами: Stripe, PayPal, Square, Adyen
- Обработка онлайн-платежей для услуг и грузоперевозок
- Поддержка банковских переводов (SWIFT, SEPA, ACH)
- Автоматическая сверка платежей с выставленными счетами
- Управление дебиторской и кредиторской задолженностью

### Система управления доходами
- Динамическое ценообразование на основе спроса, сезонности, конкуренции
- Учет скидок, промо-акций, лояльности клиентов
- Прогнозирование доходов на основе исторических данных
- Анализ рентабельности по маршрутам, клиентам, типам груза

## Технические характеристики

- **Архитектура**: Микросервис на Kotlin с gRPC API
- **База данных**: PostgreSQL с поддержкой ClickHouse для аналитики
- **Мессенджинг**: Kafka для асинхронной обработки операций
- **Безопасность**: Role-Based Access Control (RBAC), audit logging
- **Интеграции**: REST API, gRPC, Kafka topics
- **Мониторинг**: Prometheus metrics, health checks

## API

### gRPC Services

1. **FinanceLegalService** - Основной сервис для бухгалтерских операций
2. **FinancialAccountingService** - Управление инвойсами и платежами
3. **LegalModuleService** - Управление договорами и юридической документацией
4. **TaxationService** - Налоговый учет и декларации
5. **InsuranceService** - Страхование
6. **CustomsService** - Таможенные операции

## Запуск сервиса

```bash
cd finance-legal-service
./gradlew run
```

## Конфигурация

Основные параметры конфигурации:
- `server.port` - Порт запуска сервиса (по умолчанию 50055)
- `database.url` - URL подключения к PostgreSQL
- `database.user` - Имя пользователя базы данных
- `database.password` - Пароль пользователя базы данных
- `kafka.bootstrap.servers` - Адреса Kafka brokers
- `grpc.server.port` - Порт gRPC сервера

## Интеграции

- **Customs Service** - Таможенные операции
- **TMS Service** - Управление транспортом
- **WMS Service** - Управление складами
- **SCM Service** - Управление цепочками поставок
- **Платежные системы** - Stripe, PayPal, Square, Adyen

## Спецификации

- Поддержка МСФО (IFRS)
- Поддержка US GAAP
- Поддержка национальных стандартов (РСБУ, CAS, Ind AS, Japanese GAAP)
- Соответствие GDPR, CCPA, PCI DSS